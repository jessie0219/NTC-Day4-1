<script src="https://unpkg.com/vue@3"></script>

<div id="app">
    <keep-alive>
        <component :is="currentForm" @set-form="updateForm" @update="updateInfo" :form-data="form"></component>
    </keep-alive>

</div>

<script>
    const app = Vue.createApp({
        data() {
            return {
                currentForm: 'personal-component',
                form: {}
            }
        },
        methods: {
            updateForm(formName) {
                this.currentForm = formName;
            },
            updateInfo(inputData) {
                console.log(inputData);
                this.form[inputData.columnName] = inputData.columnValue;
                console.log(this.form);
            }
        }
    });
    app.component('personal-component', {
        template: `
     <label>姓名</label>
     <input v-model="name"><br>
     <label>電話</label>
     <input v-model="tel"><br>
     <button @click="nextStep">下一步</button>
  `,
        data() {
            return {
                name: '',
                tel: ''
            }
        },
        methods: {
            nextStep() {
                this.$emit('set-form', 'address-component');
            }
        },
        watch: {
            name: {
                handler(value) {
                    this.$emit('update', {
                        columnName: 'name',
                        columnValue: value
                    })
                }
            },
            tel: {
                handler(value) {
                    this.$emit('update', {
                        columnName: 'tel',
                        columnValue: value
                    })
                }
            }
        }
    });
    app.component('address-component', {
        template: `
     <label>地址</label>
     <input v-model="address"><br>
     <button @click="upStep">上一步</button>
     <button @click="nextStep">下一步</button>
  `,
        data() {
            return {
                address: ''
            }
        },
        methods: {
            nextStep() {
                this.$emit('set-form', 'final-component');
            },
            upStep() {
                this.$emit('set-form', 'personal-component')
            }
        },
        watch: {
            address: {
                handler(value) {
                    this.$emit('update', {
                        columnName: 'address',
                        columnValue: value
                    })
                }
            }
        }
    });
    app.component('final-component', {
        template: `
     <h3>請確認資料:</h3>
     <div>姓名:{{formData['name']}}</div>
     <div>電話:{{formData['tel']}}</div>
     <div>地址:{{formData['address']}}</div>
     <button @click="upStep">上一步</button>
  `,
        props: ['formData'],
        methods: {
            upStep() {
                this.$emit('set-form', 'address-component')
                console.log(this.name)
            }
        }
    });
    app.mount('#app')
</script>
